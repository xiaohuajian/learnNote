面试中，项目说的好坏会决定你的录用与否，这样会基础知识搭配才会让你有血有肉。

一般准备两个和项目有关的点：比如说 你在项目中负责的哪一块？你在项目中遇到的最有挑战的工作？你在项目中解决的最困难的问题是什么？就是想考察你对项目的熟悉程度和项目的理解程度，看出你对业务的把控能力。

我想的是把hk 的设备添加流程说一下；

重点是：

背景：在设备添加流程中，整个添加流程步骤多，结点分支多，UI多变；在这样的背景下，不进行流程拆分，会出现代码复杂、臃肿的情况，改动涉及面大；比如说：用户在点击添加设备的按钮，会出现添加本地设备、公网设备；添加设备时，可以输入序列号和设备ip 两种方式；假如说选择了输入序列号，查询设备时，设备可能在线或不在线；在线的设备需要判断设备是否跨区域；不在线的设备需要联网；联网的方式分有线（就是给设备直接连接网线，让其上线）和无线（无线连接就需要给设备配网）；无线联网又和设备的类型有关，设备的类型分为前端设备、后端设备；比如前端设备分普通ipc、门铃、对讲设备等等，这些设备在联网的时候有通用的联网方式，还有自己特殊的联网方式，比如通用的[联网方式](https://blog.csdn.net/liwei16611/article/details/81133191)手机生成一个wifi的二维码让设备扫描获取相关信息，自己联网，手机这边会一直去平台查询设备信息，查询到了就去调用添加接口；或者是smartConfig ，或者 AP 方式；然后联网的过程中，需要查询设备，这个时候又会分设备是否激活，而且激活流程又会细分 设备是否开启联网、是否加密、是否视频加密；上面说的流程大约有八步左右，每个结点还会分2-3个分支；所以这个添加设备流程是一个相对复杂的业务。同时，这样也是产品经常优化的地方，经常在这里改动；

运用了状态模式，就是把添加设备的步骤进行分解，然后对每一步进行封装为一个状态类，并抽象出公共的行为定义一个抽象类CommonState，比如showUI ，doAcition 两大块，每一个子类去重写这两个方法，做出自己的行为；

例子 ：比如 添加设备需要查询设备，就会定义一个状态类枚举值 search，同时也会写一个类AddDeviceInSearch 继承 CommonState ，重写 showUI —— 主要是加载搜索布局和UI 逻辑，比如不同界面的返回按钮其逻辑不一样、doAction 是 到服务端去搜索设备的状态接口； 

思路：在添加设备类AddDeviceAcitivity 类中，上面是导航栏，中间是contentFrameLayout；每次状态的改变，都会用新的状态去替换contentFrameLayout的展示，这样，把复杂的、多变的添加设备流程给分解成一个个的状态，通过状态的转换去对应添加过程的步骤，这样较好的解决了页面复用，灵活性也大大的增加了，只需要衔接好每个状态的转换。





AP模式：

1. 手机端连接到设备端生成的一个wifi A；
2. 这样手机就能和设备通信，手机告诉设备需要连接的wifi B 信息；这时候手机就可以断开wifi A了；
3. 设备获取wifi B的信息，并开始连接，连接上之后设备就想当于上线了；



smartConfig 原理：手机这边发送自己所连的wifi信息，并且按一下设备的配网按钮，通过手机端发送包含wifi 名称和密码的UDP协议，设备开启混杂模式，在通道channel1 - 13 来回扫描，当识别到相应的信息后，进行解析并联网，成功后也发送信息告知手机端。

硬件Wi-Fi芯片可以接收网络上一切802.11包，并在Wi-Fi信道channel1—channel13不断的切换，手机在每个信道不断的发广播包，如果接受到我们自己广播包，就解出账号密码，进行联网

<img src="https://upload-images.jianshu.io/upload_images/9922137-d8df25a4fe4bc463.png?imageMogr2/auto-orient/strip" style="zoom:75%;" />

### 动态组件界面

金融类app需要认证个人信息认证，比如身份信息认证、银行卡、人脸认证、工作信息等等，为了国际化要求，产品希望这些认证内容可以动态修改、配置，比如说个人信息中，你的信仰的宗教，有的国家需求收集这个信息，比如说印度国家，但越南就不需要；这些就是根据国家的不同，后台下发的认证信息不一样，还有一个场景就是人脸OCR 我们选择了2 家，代码也适配了2家，我们切换到其他厂商时，防止别的厂商效果不太好，我们会随时切回来；还有就是认证的顺序、项目，我们会根据收集的用户行为数据，去增加、删减一些认证项目。基于这样一个背景，我们就是用服务端下发认证项，然后描述这些信息，客户端进行展示和提交。类似于html css 解析展示。

其中的难点：我们要根据业务进行基本UI组件定义，比如说填写身份证控件，由一个textview 和输入框组成，还有那种下拉框的可以进行采集性别、或者对话框的。这些基本的UI组件要去封装成一个个自定义view，并定义业务类型key；这样key——业务组建——UI组件，三者通过key 连接起来, 通过工厂方法创建widget 业务组件。还有一点，每个组件的规则（填写、提交）比如说都是输入框控件，由于业务不同，一个身份证、一个姓名；那就是一个只能填写数字，一个可以填写文本，同时提交时还需要检查能否为空等属性。怎么更好的检查每个控件填写是否符合？设计了一个 接口Validator ，然后定义了几种常见规则，让Factory 去实现这个接口，并实现相应的规则，这样在提交时，只需要调用widget 对应的factory的 checkValidator 即可知道是否合理。这样采用了**封装组合**的思想实现了这个规则的问题；

